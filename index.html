<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ì‚¬ê±´/ìˆœì°°ì°¨ ìœ„ì¹˜ ì €ì¥ íˆ´</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  body { margin:0; padding:0; }
  #map { width:100%; height:90vh; }
  #controls { padding:10px; text-align:center; }
  button { margin: 5px; padding: 8px 12px; font-size:14px; }
</style>
</head>
<body>
<div id="controls">
  <button onclick="setMode('incident')">ğŸ“ ì‚¬ê±´ ìœ„ì¹˜ ì°ê¸°</button>
  <button onclick="setMode('car')">ğŸš” ìˆœì°°ì°¨ ìœ„ì¹˜ ì°ê¸°</button>
  <button onclick="downloadJSON()">ğŸ’¾ JSON ë‹¤ìš´ë¡œë“œ</button>
</div>
<div id="map"></div>

<script>
let map = L.map('map').setView([37.5665, 126.9780], 13); // ì„œìš¸ì‹œì²­ ê¸°ì¤€
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

let mode = null;
let incidentMarkers = [];
let carMarkers = [];

function setMode(type){
  mode = type;
  alert(type === 'incident' ? "ì‚¬ê±´ ìœ„ì¹˜ë¥¼ ì§€ë„ì— í´ë¦­í•˜ì„¸ìš”." : "ìˆœì°°ì°¨ ìœ„ì¹˜ë¥¼ ì§€ë„ì— í´ë¦­í•˜ì„¸ìš”.");
}

map.on('click', function(e){
  if(!mode) return;
  
  let marker;
  if(mode === 'incident'){
    marker = L.marker(e.latlng, {draggable:true}).addTo(map).bindPopup("ì‚¬ê±´ ìœ„ì¹˜");
    incidentMarkers.push(marker);
  } else if(mode === 'car'){
    marker = L.marker(e.latlng, {draggable:true, icon: L.icon({
      iconUrl: "https://cdn-icons-png.flaticon.com/512/68/68557.png",
      iconSize: [32,32]
    })}).addTo(map).bindPopup("ìˆœì°°ì°¨ ìœ„ì¹˜");
    carMarkers.push(marker);
  }
});

function downloadJSON(){
  let data = {
    incidents: incidentMarkers.map(m => m.getLatLng()),
    cars: carMarkers.map(m => m.getLatLng())
  };
  let blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "locations.json";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
